{% extends "base.html" %}

{% block head_content %}
<meta name="theme-color" content="#191919">

<link rel="shortcut icon" type="image/png" href="/favicons/191919.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicons/191919.ico">

<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<script src="/static/filters.js?commit={{ js_commit }}"></script>
{% endblock %}

{% block content %}
  <h2>books i&rsquo;ve read</h2>

  <p id="jumpTo">
    jump to:

    {% set_global years = [] %}
    {% for rev in reviews %}
        {% set_global years = years | concat(with=rev|year_read) %}
    {% endfor %}

    {% for y in years | unique %}
      {% if y == 'another time' %}
        <a id="jumpTo-{{ y }}" href="#another_time">another time</a>
      {% else %}
        <a id="jumpTo-{{ y }}" href="#year_{{ y }}">{{ y }}</a>
      {% endif %}

      {% if not loop.last %}
        <span aria-hidden="true">/</span>
      {% endif %}
    {% endfor %}
  </p>

  {% set heading_year = "" %}

  {% for review_entry in reviews %}
    {% if review_entry|year_read != heading_year %}

      <div class="divider"><img src="/static/book.svg"></div>

      {% if review_entry|year_read == this_year %}
        {% set count = reviews|books_in_year(year = review_entry|year_read) %}
        <h3 id="year_{{ review_entry|year_read }}">the {{ count }} book{% if count > 1 %}s{% endif %} i&rsquo;ve read so far in {{ review_entry|year_read }}</h3>
      {% elif review_entry|year_read == 'another time' %}
        <h3 id="another_time">books i read at another time</h3>

        <details>
          <summary style="margin-bottom: 1em">
            this is an (incomplete) list of the books I read before I started keeping proper records.
            the list is ordered by publication date, not reading date, and lacks a lot of detail.
          </summary>

          {% set_global read_at_another_time = true %}

      {% else %}
        {% set count = reviews|books_in_year(year = review_entry|year_read) %}
        <h3 id="year_{{ review_entry|year_read }}">the {{ count }} book{% if count > 1 %}s{% endif %} i read in {{ review_entry|year_read }}</h3>
      {% endif %}
      {% set_global heading_year = review_entry|year_read %}
    {% endif %}

    {% include "_review_entry.html" %}
  {% endfor %}
  </details>

  <script>
    console.log(getAuthorNames());
  </script>
{% endblock %}
