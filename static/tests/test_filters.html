<meta charset="utf-8">

<script src="../filters.js"></script>

<script src="./test_helpers.js"></script>
<link rel="stylesheet" href="./test_helpers.css">

<ul id="test_cases"></ul>

<div
  id="review_preview_1"
  data-book-authors="John Jones"
  data-book-publication-year="2001"
  data-review-rating="3"
  data-review-tags="fiction sci-fi"
>

<div
  id="review_preview_2"
  data-book-authors="John Jones and Sarah Smith"
  data-book-publication-year="2021"
  data-review-rating="4"
  data-review-tags="non-fiction botany"
>

<div
  id="review_preview_3"
  data-book-authors="Sarah Smith"
  data-book-publication-year="2021"
  data-review-rating=""
  data-review-tags="non-fiction botany"
>

<script>
  it('createPublicationYearLabel: a range of years', () => {
    assertEqual(
      createPublicationYearLabel({ afterYear: '2001', beforeYear: '2002' }),
      'published between 2001 and 2002'
    );
  })

  it('createPublicationYearLabel: a single year', () => {
    assertEqual(
      createPublicationYearLabel({ afterYear: '2001', beforeYear: '2001' }),
      'published in 2001'
    );
  })

  it('createPublicationYearLabel: published after', () => {
    assertEqual(
      createPublicationYearLabel({ afterYear: '2001', beforeYear: undefined }),
      'published after 2001'
    );
  })

  it('createPublicationYearLabel: published before', () => {
    assertEqual(
      createPublicationYearLabel({ afterYear: undefined, beforeYear: '2002' }),
      'published before 2002'
    );
  })

  it('createPublicationYearLabel: current year', () => {
    assertEqual(
      createPublicationYearLabel({ afterYear: '2022', beforeYear: undefined }),
      'published in 2022'
    );
  })

  it('getAuthorNames: single author', () => {
    assertEqual(
      getAuthorNames('Laura Jane Williams'),
      ['Laura Jane Williams']
    );
  })

  it('getAuthorNames: single author with period', () => {
    assertEqual(
      getAuthorNames('J. K. Rowling'),
      ['J. K. Rowling']
    );
  })

  it('getAuthorNames: single author with ‘and’ as a substring', () => {
    assertEqual(
      getAuthorNames('B. Jack Copeland'),
      ['B. Jack Copeland']
    );
  })

  it('getAuthorNames: multiple authors with commas', () => {
    assertEqual(
      getAuthorNames('Ben Crystal, David Crystal'),
      ['Ben Crystal', 'David Crystal']
    );
  })

  it('getAuthorNames: multiple authors with ampersand', () => {
    assertEqual(
      getAuthorNames('Douglas Adams & Mark Carwadine'),
      ['Douglas Adams', 'Mark Carwadine']
    );
  })

  it('getAuthorNames: multiple authors with and', () => {
    assertEqual(
      getAuthorNames('F.H. Hinsley and Alan Tripp'),
      ['F.H. Hinsley', 'Alan Tripp']
    );
  })

  it('getAuthorNames: multiple authors with an Oxford comma', () => {
    assertEqual(
      getAuthorNames('Lisa McMullin, Tim Foley, and Timothy X. Atack'),
      ['Lisa McMullin', 'Tim Foley', 'Timothy X. Atack']
    );
  })

  const book1 = document.querySelector('#review_preview_1');
  const book2 = document.querySelector('#review_preview_2');
  const book3 = document.querySelector('#review_preview_3');

  const emptyFilters = {
    authors: [],
    publicationYear: {
      before: undefined,
      after: undefined,
    },
    starRating: undefined,
    tags: [],
  };

  it('matchesFilters: matches everything if there are no filters', () => {
    assertTrue(matchesFilters(book1, emptyFilters));
    assertTrue(matchesFilters(book2, emptyFilters));
    assertTrue(matchesFilters(book3, emptyFilters));
  })

  it('matchesFilters: matching on a single author name', () => {
    const filters = {
      ...emptyFilters,
      'authors': ['Sarah Smith'],
    };

    assertFalse(matchesFilters(book1, filters));
    assertTrue(matchesFilters(book2, filters));
    assertTrue(matchesFilters(book3, filters));
  })

  it('matchesFilters: matching on multiple author names', () => {
    const filters = {
      ...emptyFilters,
      authors: ['Sarah Smith', 'Laura Lee'],
    };

    assertFalse(matchesFilters(book1, filters));
    assertTrue(matchesFilters(book2, filters));
    assertTrue(matchesFilters(book3, filters));
  })
</script>
